<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FLAVA FEST – Descuento</title>

<!-- Fallback extremo: si nada carga JS, redirige en 4s -->
<meta http-equiv="refresh" content="4;url=https://www.joinnus.com/events/festivales/lima-flava-festival-70366/canje">

<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
       padding:24px; line-height:1.5; max-width:720px; margin:auto; text-align:center}
  .card{border:1px solid #ddd; border-radius:16px; padding:20px; box-shadow:0 4px 16px rgba(0,0,0,.06)}
  h1{font-size:1.5rem; margin:0 0 8px}
  .code{font-weight:700; font-size:1.25rem; letter-spacing:.5px}
  .btn{display:inline-block; padding:12px 18px; border-radius:999px; text-decoration:none; border:1px solid #ccc; cursor:pointer}
  .muted{opacity:.8}
</style>
</head>
<body>
  <div class="card">
    <h1>Aplicando tu descuento…</h1>
    <p>Tu código <span class="code">KEENSTYLES</span> se copiará automáticamente y te llevaremos al canje.</p>
    <p class="muted">Si no te redirige solo, toca aquí:</p>
    <p><a class="btn" id="go" href="https://www.joinnus.com/events/festivales/lima-flava-festival-70366/canje">Ir al canje en Joinnus</a></p>
    <p class="muted">¿No se copió? <button class="btn" id="copyBtn" type="button">Copiar código</button></p>
  </div>

  <!-- Campo oculto para fallback de copiado -->
  <input id="hiddenCode" value="KEENSTYLES" style="position:absolute;left:-9999px;top:-9999px" aria-hidden="true">

<script>
(function(){
  const CODE = "KEENSTYLES";
  const joinnus = "https://www.joinnus.com/events/festivales/lima-flava-festival-70366/canje";
  const copyBtn = document.getElementById('copyBtn');
  const go = document.getElementById('go');
  const hidden = document.getElementById('hiddenCode');

  // Intento principal: Clipboard API (HTTPS requerido; GitHub Pages lo cumple)
  function copyViaClipboardAPI(){
    if (!navigator.clipboard || !navigator.clipboard.writeText) throw new Error('Clipboard API no disponible');
    return navigator.clipboard.writeText(CODE);
  }

  // Fallback: seleccionar input oculto y copiar (mejor con interacción, pero probamos)
  function copyViaHiddenInput(){
    hidden.focus();
    hidden.select();
    const ok = document.execCommand && document.execCommand('copy'); // puede estar deprecado pero aún funciona en varios browsers
    if (!ok) throw new Error('execCommand falló');
    return Promise.resolve();
  }

  function tryCopyAuto(){
    return copyViaClipboardAPI().catch(copyViaHiddenInput);
  }

  // Copia automático + redirección rápida
  tryCopyAuto().finally(()=>{
    // Pequeño delay para que el copiado termine antes de salir
    setTimeout(()=>{ window.location.href = joinnus; }, 800);
  });

  // Botón manual por si el auto-copiado falla (iOS/Safari suele requerir gesto del usuario)
  copyBtn.addEventListener('click', async ()=>{
    try {
      await copyViaClipboardAPI().catch(copyViaHiddenInput);
      copyBtn.textContent = '¡Copiado!';
      setTimeout(()=>{ window.location.href = joinnus; }, 300);
    } catch(e){
      copyBtn.textContent = 'Copia el código: ' + CODE;
    }
  });

  // Si el usuario toca el link, nos aseguramos de intentar copiar justo antes
  go.addEventListener('click', async (e)=>{
    try {
      await copyViaClipboardAPI().catch(copyViaHiddenInput);
    } catch(_) {}
    // dejamos que siga el enlace
  });
})();
</script>

<noscript>
  <p>JavaScript desactivado: entra a
    <a href="https://www.joinnus.com/events/festivales/lima-flava-festival-70366/canje">Joinnus</a>
    y pega el código <strong>KEENSTYLES</strong> en “Código de descuento”.</p>
</noscript>
</body>
</html>
